# Nose-Hoover法のエルゴード性

Nose-Hoover法が保証するのは「位相空間をボルツマン重みに比例して走る」ということだけである。さらに「軌道が位相空間をくまなく走る」という条件が満たされて初めて、定常状態が指定温度のカノニカル分布となる。この条件をエルゴード性と呼ぶ。

エルゴード性の定義は難しい。一般的には、時間平均とアンサンブル平均が等しいことを持ってエルゴード的であると定義する。逆に、時間平均とアンサンブル平均が一致しない場合、「エルゴード性が破れている」と表現する。厳密さを犠牲にした表現をすれば、力学系において「長時間極限で到達可能性のある領域全てに到達可能」であればエルゴード的、そうでなければ非エルゴード的と呼ぶ。

さて、Nose-Hoover法は条件によってはエルゴード性を失うことが知られている。以下では、エルゴード性を失うとはどういうことか、エルゴード性はなぜ失われるか、どうすればエルゴード性を回復するかを見てみよう。

一次元調和振動子系にNose-Hoover法を適用してみよう。質量を$1$、目標温度を$1$とすると、運動方程式は以下のようになる。

$$
\begin{aligned}
\dot{p} &= -q - p \zeta \\
\dot{q} &= p \\
\dot{\zeta} &= \frac{1}{Q}(p^2-1)
\end{aligned}
$$

さて、この運動方程式が、$(p,q,\zeta)$空間でどのような流れを作っているか見てみよう。

まず、ハミルトンの運動方程式由来の流れは以下の通り。

$$
\begin{aligned}
\dot{p} &= -q \\
\dot{q} &= p 
\end{aligned}
$$

この系は$C = p^2 + q^2$、すなわち原点を中心とした円軌道を時間不変量に持つ。従って、この運動方程式は$(p,q)$空間において、原点を中心として反時計回りに回転する流れを作っている。

Nose-Hoover法として追加された流れ場は以下の通り。

$$
\begin{aligned}
\frac{dp}{dt} &= -p\zeta \\
\frac{d\zeta}{dt} &= \frac{1}{Q}(p^2-1)
\end{aligned}
$$

よく見ると、この微分方程式は変数分離形になっているために求積できる。

$$
\frac{dp}{d\zeta} = \frac{Q p\zeta}{(p^2-1)}
$$

$$
\left(p - \frac{1}{p} \right)dp = -Q \zeta d\zeta
$$

ここから、以下の時間不変量を得る。

$$
C = \frac{p^2}{2} - \ln p + \frac{Q\zeta^2}{2}
$$

これは$(p,\zeta)$空間において閉曲線を作っており、先程の運動方程式はその閉曲線上を走る、やはり回転する流れを作っている。

以上をまとめると、調和振動子+Nose-Hoover系は位相空間に以下のような流れ場を作っている。

![調和振動子+Nose-Hoover法の流れ](nhflow.png)

さて、調和振動子系のハミルトニアンは$H=p^2/2 + q^2/2$である。この系においてカノニカル分布が実現するとは、分布関数$f(p,q)$が、ボルツマン重み

$$
f \sim \exp(-\beta H)
$$

に従うことだ。ここで、エネルギーが高ければ高いほど、その分布の実現確率は指数関数的に低くなるが、ゼロではないことに注意したい。これから、調和振動子系にNose-Hoover法を適用すると、系に非自明な保存量が構築され、その結果としてエネルギーに下限、上限ができるためにカノニカル分布が実現しないことを示す。

まず、$(p,q)$空間において回転しているので、極座標を取るのが自然であろう。以下のように$(p,q)$から$(r, \zeta)$に変数変換する。

$$
\begin{aligned}
p &= r \cos \theta \\
q &= r \sin \theta \\
\end{aligned}
$$

ここから$(r,\zeta, \zeta)$の運動方程式を導こう。

まず、$r^2/2 = p^2/2 + q^2/2$であるから、両辺を時間で微分すると、

$$
\begin{aligned}
r\dot{r} &= p \dot{p} + q \dot{q} \\
&= p (-q-p\zeta) + pq \\
&= -p^2 \zeta \\
&= - r^2 \zeta \cos^2 \theta
\end{aligned}
$$

以上から、

$$
\begin{aligned}
\dot{r} &= -r \zeta \cos^2 \theta \\
\dot{\zeta} &= \frac{1}{Q}(r^2 \cos^2 \theta - 1)
\end{aligned}
$$

ここで、$Q$が十分に大きい場合、$r, \zeta$の運動は$\theta$に比べて非常に遅くなるであろう。そこで、$\theta$について平均を取る(断熱近似)。

$$
\begin{aligned}
\frac{d r}{dt} &= - \frac{r \zeta}{2} \\
\frac{d\zeta}{dt} &= \frac{1}{Q}\left(\frac{r^2}{2} - 1\right)
\end{aligned}
$$

これは$r,\zeta$に関して変数分離形になっている。

$$
\frac{d r}{d \zeta} = - \frac{r\zeta}{2} \frac{Q}{\left(r^2/2 - 1\right)}
$$

$$
\left(\frac{r}{2} - \frac{1}{r}\right) dr = -\frac{Q\zeta}{2} d\zeta
$$

ここから直ちに以下の時間不変量(第一積分)を得る。

$$
C = r^2 - \ln r + Q\zeta^2
$$

さて、$Q \zeta^2$はゼロより大きいので、

$$
r^2 - \ln r \le C
$$

ここで$r^2 - \ln r$は$r\rightarrow 0$もしくは$r\rightarrow \infty$で無限大となり、その間に最小値を取るような下に凸な関数である。それがある閾値以下に制限されているということは、$r$のとり得る値に下限と上限が存在する、ということを意味する。

![断熱近似によるエルゴード性の破れ](r_range.png)

もともと$H = r^2/2$であったから、これはエネルギーに非自明な下限と上限が設けられた、すなわち軌道が位相空間全体を埋め尽くさず、結果としてエルゴード性を失うことがわかる。

ここでは$Q$が大きいとして断熱近似を行ったが、実際にやってみると$Q$がある程度小さくても実効的に変数分離が起きて、エルゴード性が破れることがわかる。

TODO: 他のエルゴード性の破れや多変数熱浴の話

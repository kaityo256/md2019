<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="generator" content="pandoc">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                                <title>ergodic/index.md</title>
        <style type="text/css">
            code {
                white-space: pre;
            }
        </style>
                <style type="text/css">
            div.sourceCode {
                overflow-x: auto;
            }

            table.sourceCode,
            tr.sourceCode,
            td.lineNumbers,
            td.sourceCode {
                margin: 0;
                padding: 0;
                vertical-align: baseline;
                border: none;
            }

            table.sourceCode {
                width: 100%;
                line-height: 100%;
            }

            td.lineNumbers {
                text-align: right;
                padding-right: 4px;
                padding-left: 4px;
                color: #aaaaaa;
                border-right: 1px solid #aaaaaa;
            }

            td.sourceCode {
                padding-left: 5px;
            }

            code>span.kw {
                color: #007020;
                font-weight: bold;
            }

            /* Keyword */
            code>span.dt {
                color: #902000;
            }

            /* DataType */
            code>span.dv {
                color: #40a070;
            }

            /* DecVal */
            code>span.bn {
                color: #40a070;
            }

            /* BaseN */
            code>span.fl {
                color: #40a070;
            }

            /* Float */
            code>span.ch {
                color: #4070a0;
            }

            /* Char */
            code>span.st {
                color: #4070a0;
            }

            /* String */
            code>span.co {
                color: #60a0b0;
                font-style: italic;
            }

            /* Comment */
            code>span.ot {
                color: #007020;
            }

            /* Other */
            code>span.al {
                color: #ff0000;
                font-weight: bold;
            }

            /* Alert */
            code>span.fu {
                color: #06287e;
            }

            /* Function */
            code>span.er {
                color: #ff0000;
                font-weight: bold;
            }

            /* Error */
            code>span.wa {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            }

            /* Warning */
            code>span.cn {
                color: #880000;
            }

            /* Constant */
            code>span.sc {
                color: #4070a0;
            }

            /* SpecialChar */
            code>span.vs {
                color: #4070a0;
            }

            /* VerbatimString */
            code>span.ss {
                color: #bb6688;
            }

            /* SpecialString */
            code>span.im {}

            /* Import */
            code>span.va {
                color: #19177c;
            }

            /* Variable */
            code>span.cf {
                color: #007020;
                font-weight: bold;
            }

            /* ControlFlow */
            code>span.op {
                color: #666666;
            }

            /* Operator */
            code>span.bu {}

            /* BuiltIn */
            code>span.ex {}

            /* Extension */
            code>span.pp {
                color: #bc7a00;
            }

            /* Preprocessor */
            code>span.at {
                color: #7d9029;
            }

            /* Attribute */
            code>span.do {
                color: #ba2121;
                font-style: italic;
            }

            /* Documentation */
            code>span.an {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            }

            /* Annotation */
            code>span.cv {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            }

            /* CommentVar */
            code>span.in {
                color: #60a0b0;
                font-weight: bold;
                font-style: italic;
            }

            /* Information */
        </style>

        <style>
            .btn-square {
                display: inline-block;
                padding: 0.5em 0.5em;
                text-decoration: none;
                background: #668ad8;
                color: #FFF;
                border-bottom: solid 4px #626295;
                border-radius: 5px;
            }

            .btn-square:active {
                -webkit-transform: translateY(4px);
                transform: translateY(4px);
                border-bottom: none;
            }

            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }

            p.caption {
                display: none;
            }

            img {
                width: 100%
            }

            @media (max-width: 767px) {
                .markdown-body {
                    padding: 15px;
                }
            }
        </style>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://kaityo256.github.io/python_zero/github-markdown.css" type="text/css" />
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
        <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
                <link href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" rel="stylesheet">
    </head>

    <body>
        <article class="markdown-body">
                                                <h1 id="problems-on-nose-hoover-method">Problems on Nose-Hoover method</h1>
<p><a href="../index.html">[Up]</a> <a href="https://github.com/kaityo256/md2019">[Repository]</a></p>
<p>Nose-Hoover法は実装が容易であり、他の熱浴(例えばVelocity Scaling法やBerendsenの方法)と違って厳密にカノニカル分布を定常状態に持つことから広く使われている。しかし、Nose-Hoover法で温度制御された系が、意図する状態にならない場合がある。広く知られているのは調和振動子にNose-Hoover法を適用するとエルゴード性が破れる例だが、他にもいくつか問題がある。以下ではNose-Hoover法を使う上での注意点について述べる。</p>
<h2 id="ergodicity-of-the-nose-hoover-method">Ergodicity of the Nose-Hoover Method</h2>
<p>Nose-Hoover法が保証するのは「位相空間をボルツマン重みに比例して走る」ということだけである。さらに「軌道が位相空間をくまなく走る」という条件が満たされて初めて、定常状態が指定温度のカノニカル分布となる。この条件をエルゴード性と呼ぶ。</p>
<p>エルゴード性の定義は難しい。一般的には、時間平均とアンサンブル平均が等しいことを持ってエルゴード的であると定義する。逆に、時間平均とアンサンブル平均が一致しない場合、「エルゴード性が破れている」と表現する。厳密さを犠牲にした表現をすれば、力学系において「長時間極限で到達可能性のある領域全てに到達可能」であればエルゴード的、そうでなければ非エルゴード的と呼ぶ。</p>
<p>さて、Nose-Hoover法は条件によってはエルゴード性を失うことが知られている。以下では、エルゴード性を失うとはどういうことか、エルゴード性はなぜ失われるか、どうすればエルゴード性を回復するかを見てみよう。</p>
<p>一次元調和振動子系にNose-Hoover法を適用してみよう。質量を<span class="math inline">\(1\)</span>、目標温度を<span class="math inline">\(1\)</span>とすると、運動方程式は以下のようになる。</p>
<p><span class="math display">\[
\begin{aligned}
\dot{p} &amp;= -q - p \zeta \\
\dot{q} &amp;= p \\
\dot{\zeta} &amp;= \frac{1}{Q}(p^2-1)
\end{aligned}
\]</span></p>
<p>さて、この運動方程式が、<span class="math inline">\((p,q,\zeta)\)</span>空間でどのような流れを作っているか見てみよう。</p>
<p>まず、ハミルトンの運動方程式由来の流れは以下の通り。</p>
<p><span class="math display">\[
\begin{aligned}
\dot{p} &amp;= -q \\
\dot{q} &amp;= p 
\end{aligned}
\]</span></p>
<p>この系は<span class="math inline">\(C = p^2 + q^2\)</span>、すなわち原点を中心とした円軌道を時間不変量に持つ。従って、この運動方程式は<span class="math inline">\((p,q)\)</span>空間において、原点を中心として反時計回りに回転する流れを作っている。</p>
<p>Nose-Hoover法として追加された流れ場は以下の通り。</p>
<p><span class="math display">\[
\begin{aligned}
\frac{dp}{dt} &amp;= -p\zeta \\
\frac{d\zeta}{dt} &amp;= \frac{1}{Q}(p^2-1)
\end{aligned}
\]</span></p>
<p>よく見ると、この微分方程式は変数分離形になっているために求積できる。</p>
<p><span class="math display">\[
\frac{dp}{d\zeta} = \frac{Q p\zeta}{(p^2-1)}
\]</span></p>
<p><span class="math display">\[
\left(p - \frac{1}{p} \right)dp = -Q \zeta d\zeta
\]</span></p>
<p>ここから、以下の時間不変量を得る。</p>
<p><span class="math display">\[
C = \frac{p^2}{2} - \ln p + \frac{Q\zeta^2}{2}
\]</span></p>
<p>これは<span class="math inline">\((p,\zeta)\)</span>空間において閉曲線を作っており、先程の運動方程式はその閉曲線上を走る、やはり回転する流れを作っている。</p>
<p>以上をまとめると、調和振動子+Nose-Hoover系は位相空間に以下のような流れ場を作っている。</p>
<figure>
<img src="nhflow.png" alt="調和振動子+Nose-Hoover法の流れ" /><figcaption>調和振動子+Nose-Hoover法の流れ</figcaption>
</figure>
<p>さて、調和振動子系のハミルトニアンは<span class="math inline">\(H=p^2/2 + q^2/2\)</span>である。この系においてカノニカル分布が実現するとは、分布関数<span class="math inline">\(f(p,q)\)</span>が、ボルツマン重み</p>
<p><span class="math display">\[
f \sim \exp(-\beta H)
\]</span></p>
<p>に従うことだ。ここで、エネルギーが高ければ高いほど、その分布の実現確率は指数関数的に低くなるが、ゼロではないことに注意したい。これから、調和振動子系にNose-Hoover法を適用すると、系に非自明な保存量が構築され、その結果としてエネルギーに下限、上限ができるためにカノニカル分布が実現しないことを示す。</p>
<p>まず、<span class="math inline">\((p,q)\)</span>空間において回転しているので、極座標を取るのが自然であろう。以下のように<span class="math inline">\((p,q)\)</span>から<span class="math inline">\((r, \zeta)\)</span>に変数変換する。</p>
<p><span class="math display">\[
\begin{aligned}
p &amp;= r \cos \theta \\
q &amp;= r \sin \theta \\
\end{aligned}
\]</span></p>
<p>ここから<span class="math inline">\((r,\zeta, \zeta)\)</span>の運動方程式を導こう。</p>
<p>まず、<span class="math inline">\(r^2/2 = p^2/2 + q^2/2\)</span>であるから、両辺を時間で微分すると、</p>
<p><span class="math display">\[
\begin{aligned}
r\dot{r} &amp;= p \dot{p} + q \dot{q} \\
&amp;= p (-q-p\zeta) + pq \\
&amp;= -p^2 \zeta \\
&amp;= - r^2 \zeta \cos^2 \theta
\end{aligned}
\]</span></p>
<p>以上から、</p>
<p><span class="math display">\[
\begin{aligned}
\dot{r} &amp;= -r \zeta \cos^2 \theta \\
\dot{\zeta} &amp;= \frac{1}{Q}(r^2 \cos^2 \theta - 1)
\end{aligned}
\]</span></p>
<p>ここで、<span class="math inline">\(Q\)</span>が十分に大きい場合、<span class="math inline">\(r, \zeta\)</span>の運動は<span class="math inline">\(\theta\)</span>に比べて非常に遅くなるであろう。そこで、<span class="math inline">\(\theta\)</span>について平均を取る(断熱近似)。</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d r}{dt} &amp;= - \frac{r \zeta}{2} \\
\frac{d\zeta}{dt} &amp;= \frac{1}{Q}\left(\frac{r^2}{2} - 1\right)
\end{aligned}
\]</span></p>
<p>これは<span class="math inline">\(r,\zeta\)</span>に関して変数分離形になっている。</p>
<p><span class="math display">\[
\frac{d r}{d \zeta} = - \frac{r\zeta}{2} \frac{Q}{\left(r^2/2 - 1\right)}
\]</span></p>
<p><span class="math display">\[
\left(\frac{r}{2} - \frac{1}{r}\right) dr = -\frac{Q\zeta}{2} d\zeta
\]</span></p>
<p>ここから直ちに以下の時間不変量(第一積分)を得る。</p>
<p><span class="math display">\[
C = r^2 - \ln r + Q\zeta^2
\]</span></p>
<p>さて、<span class="math inline">\(Q \zeta^2\)</span>はゼロより大きいので、</p>
<p><span class="math display">\[
r^2 - \ln r \le C
\]</span></p>
<p>ここで<span class="math inline">\(r^2 - \ln r\)</span>は<span class="math inline">\(r\rightarrow 0\)</span>もしくは<span class="math inline">\(r\rightarrow \infty\)</span>で無限大となり、その間に最小値を取るような下に凸な関数である。それがある閾値以下に制限されているということは、<span class="math inline">\(r\)</span>のとり得る値に下限と上限が存在する、ということを意味する。</p>
<figure>
<img src="r_range.png" alt="断熱近似によるエルゴード性の破れ" /><figcaption>断熱近似によるエルゴード性の破れ</figcaption>
</figure>
<p>もともと<span class="math inline">\(H = r^2/2\)</span>であったから、これはエネルギーに非自明な下限と上限が設けられた、すなわち軌道が位相空間全体を埋め尽くさず、結果としてエルゴード性を失うことがわかる。</p>
<p>ここでは<span class="math inline">\(Q\)</span>が大きいとして断熱近似を行ったが、実際にやってみると<span class="math inline">\(Q\)</span>がある程度小さくても実効的に変数分離が起きて、エルゴード性が破れることがわかる。</p>
<p>たまに、エルゴード性が破れるのは系が単自由度である場合であり、多自由度系であれば問題ない、といった誤解を見かける。しかし、エルゴード性が破れるのは追加自由度<span class="math inline">\(\zeta\)</span>が系の部分自由度と強く結合して非自明な保存量を構築するからであった。従って、多自由度系であっても同様なことが起き得るので注意が必要である。</p>
<p>この問題は早くから認識され、エルゴード性を回復する手法が提案された。最も簡単には、熱浴自由度を追加してしまう方法が考えられる。</p>
<p>代表的なものの一つはKinetic-Moments法で、これは<span class="math inline">\(p\)</span>の高次のモーメントも制御する方法である。もう一つはNose-Hoover-Chain法で、追加自由度<span class="math inline">\(\zeta\)</span>も、別の自由度で温度制御しよう、という方法だ。いずれも自由度が追加されているため、断熱近似しても変数分離形にならず、結果としてエルゴード性が破れない。</p>
<h2 id="other-problems-on-nose-hoover-method">Other Problems on Nose-Hoover method</h2>
<h3 id="non-uniform-steady-state">Non-uniform Steady State</h3>
<p>Nose-Hoover法の問題として調和振動子でエルゴード性が破れる現象が有名であるが、実用上では他の現象が問題となることの方が多い。そのうちの一つは、「系の温度が非一様のまま定常状態となる」問題だ。</p>
<p>Nose-Hoover法が制御するのは「系全体の温度」つまり平均温度である。従って、平均温度が指定の温度になっていればNose-Hoover法から見れば温度が制御できているように見える。しかし、なんらかの原因により高温の領域と低温領域にわかれてしまい、それが定常化する場合がある。</p>
<p>典型例は相分離する系である。例えば液滴と気相の共存状態を作ろうとして、最初に真空中に液滴を置いて蒸発させることで定常状態を作ろうとすると、液滴は気化熱により温度が下がり、その分Nose-Hoover法は全体の温度を上げて対応しようとするため、低温の液滴と高温の蒸気に分かれて安定化してしまう。液滴と蒸気の相互作用は非常に弱いため、現実的な時間では温度が一様にならない。</p>
<figure>
<img src="phase_separation.png" alt="温度が非一様のまま定常化" /><figcaption>温度が非一様のまま定常化</figcaption>
</figure>
<p>上図は、二種の合金が相分離した例だ。Nose-Hoover法は全体だけを見て温度を制御した気になっているが、実はA原子とB原子それぞれの温度を見ると、異なる温度で固定されてしまっている。Langevin系では、全体も、A、B原子個別に見ても同じ温度に緩和していることがわかる。</p>
<p>この問題は、Nose-Hoover系のみならず、系全体の平均運動エネルギーを制御する熱浴(Velocity-Scaling, Berendsen, Kinetic-Momentsその他の他自由度熱浴)全てで起きる可能性がある。なお、Langevin熱浴は各自由度ごとに制御がかかるため、このような問題は生じない。</p>
<h3 id="non-trivial-oscillation">Non-trivial Oscillation</h3>
<p>Nose-Hoover法は、新たに追加した自由度<span class="math inline">\(\zeta\)</span>が、<span class="math inline">\((p,\zeta)\)</span>空間に回転流れを作ることは既に述べた。Nose-Hoover法を用いると、この回転に由来する「振動」が系に導入される。</p>
<figure>
<img src="spectra.png" alt="熱浴による振動" /><figcaption>熱浴による振動</figcaption>
</figure>
<p>上左図は、熱浴をつけてない場合とつけた場合の系の温度の時間発展だ。熱浴をつけていない系はおよそ1.3の温度を持つが、熱浴で<span class="math inline">\(T=1\)</span>に制御した系は、意図通り温度が1付近で揺らいでいるように見える。</p>
<p>この温度の時間変化をフーリエ変換し、パワースペクトルを見てみよう。熱浴をつけていない場合は、原点に強いピークが立つが、それ以外の成分はほとんどゼロ、すなわちこの系の温度ゆらぎは、ほぼホワイトノイズとみなすことができる。</p>
<p>しかし、熱浴をつけた場合は、スペクトルに熱浴由来のピークが立つ。静的な性質を調べている場合はあまり問題とならないが、何かのゆらぎやスペクトルを調べている場合には、熱浴由来の振動と干渉しないように十分に注意しなければならない。この問題は温度を一階の遅れで制御するNose-Hoover系特有の問題であり、Velocity-Scaling法やBerendsen法では起きない。</p>
<h3 id="slow-relaxation-of-configuration-temperature">Slow relaxation of Configuration Temperature</h3>
<p>温度には「運動温度(Kinetic Tempearture)」と「状態温度(Configuration Temperature)」があることは既に述べた。それぞれ</p>
<p><span class="math display">\[
\left&lt;p \frac{\partial H}{\partial p} \right&gt; = k_B T
\]</span></p>
<p><span class="math display">\[
\left&lt;q \frac{\partial H}{\partial q} \right&gt; = k_B T
\]</span></p>
<p>と定義され、カノニカル分布について部分積分すると上記の式が証明できる。これらは平衡状態では一致するが、非平衡状態では一般に一致しない。</p>
<p>我々が温度依存性を知りたいのは、運動エネルギー部分ではなく、状態部分であることが多い。Nose-Hoover法を始めとする多くの熱浴は、運動温度を制御することで、「そのうち状態温度も指定の温度に緩和するだろう」ということを期待するが、一般に運動温度に比べて状態温度の緩和は遅い。</p>
<figure>
<img src="two_t.png" alt="二つの温度" /><figcaption>二つの温度</figcaption>
</figure>
<p>上図は、FCCに組んだLJ原子系の運動温度と状態温度の緩和を見たものだ。なお、温度制御はしておらず、純粋にハミルトンの運動方程式を解いている(そのため、運動温度が振動していない)。二つの温度は最終的に一致するが、二つの温度が異なることがわかるであろう。</p>
<p>特に系が相分離する場合や、ガラス系に見られるような遅い構造緩和を持つ場合は、状態温度の緩和は非常に遅くなる。このような時、運動温度しかモニターしていないと、自分が意図する温度とはずれた状態温度における振る舞いを観測してしまうので注意が必要である。</p>
<p>この問題は、決定論熱浴だけでなく、Langevin法などの確率的熱浴でも起こり得る。</p>
                    </article>
    </body>

    </html>